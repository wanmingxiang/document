### 从集群故障

#### 计算集群故障

##### 只备份日志

    * 计算集群在重新上电后，必须replay所有落后的日志，才能提供服务；
    * DBStore 需要感知计算的备集群故障，且归档日志直到计算集群恢复后，才能删除; 

##### 备份日志&数据

    * 对主集群对可服务性没有影响，数据和日志都会实时备份，等计算集群恢复后，继续提供只读能力；

#### 存储集群故障

##### 只备份日志

    * 计算集群不对外提供服务，等待存储集群恢复；
    * 存储集群在重新上电后，保持catch up主集群等日志(日志同步如果不可保序，对计算返错)；
    * DBStore可以提供服务后，计算节点repaly日志，完成后对外提供读服务 ; 

##### 备份日志&数据

    * 对主集群对可服务性没有影响，DBStore不可访问，Node不对外提供服务（标记为Fault状态）
    * 存储集群在上电后， 需要catch up主集群对数据及日志，追上后，可提供DBStore可对外提供服务；

### 主集群故障

#### 计算集群故障

    * commit提交后，事务已经落盘, 计算集群掉电后，客户端没有收到commit的ack;
    * cm能感知到故障，需要15s心跳；(这段时间iofence没有办法生效）
    * 从存储集群判断当前是否和主端一致，一致到情况下，切主；
    * 从计算集群升主, repaly完成后，对外提供服务；

#### 存储集群故障

    * DBStore client无法继续提供服务，标记Node为故障状态；
    
    * 存储站点主从切换；
    * 计算站点主从切换；
    * 对外提供(RW)服务;
